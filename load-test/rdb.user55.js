import http from 'k6/http';
import {check, group, sleep} from 'k6';

export const options = {
  vus: 400,              // 동시 사용자 수
  duration: '30s',      // 테스트 시간
};

const BASE_URL = 'http://192.168.0.101:8080/api/user-activities';

const userIds = [
  "aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa",
  "bbbbbbbb-bbbb-bbbb-bbbb-bbbbbbbbbbbb",
  "cccccccc-cccc-cccc-cccc-cccccccccccc",
  "dddddddd-dddd-dddd-dddd-dddddddddddd",
  "00000000-0000-0000-0000-000000000001",
  "00000000-0000-0000-0000-000000000002",
  "00000000-0000-0000-0000-000000000003",
  "00000000-0000-0000-0000-000000000004",
  "00000000-0000-0000-0000-000000000005",
  "00000000-0000-0000-0000-000000000006",
  "00000000-0000-0000-0000-000000000007",
  "00000000-0000-0000-0000-000000000008",
  "00000000-0000-0000-0000-000000000009",
  "00000000-0000-0000-0000-000000000010",
  "00000000-0000-0000-0000-000000000011",
  "00000000-0000-0000-0000-000000000012",
  "00000000-0000-0000-0000-000000000013",
  "00000000-0000-0000-0000-000000000014",
  "00000000-0000-0000-0000-000000000015",
  "00000000-0000-0000-0000-000000000016",
  "00000000-0000-0000-0000-000000000017",
  "00000000-0000-0000-0000-000000000018",
  "00000000-0000-0000-0000-000000000019",
  "00000000-0000-0000-0000-000000000020",
  "00000000-0000-0000-0000-000000000021",
  "00000000-0000-0000-0000-000000000022",
  "00000000-0000-0000-0000-000000000023",
  "00000000-0000-0000-0000-000000000024",
  "00000000-0000-0000-0000-000000000025",
  "00000000-0000-0000-0000-000000000026",
  "00000000-0000-0000-0000-000000000027",
  "00000000-0000-0000-0000-000000000028",
  "00000000-0000-0000-0000-000000000029",
  "00000000-0000-0000-0000-000000000030",
  "00000000-0000-0000-0000-000000000031",
  "00000000-0000-0000-0000-000000000032",
  "00000000-0000-0000-0000-000000000033",
  "00000000-0000-0000-0000-000000000034",
  "00000000-0000-0000-0000-000000000035",
  "00000000-0000-0000-0000-000000000036",
  "00000000-0000-0000-0000-000000000037",
  "00000000-0000-0000-0000-000000000038",
  "00000000-0000-0000-0000-000000000039",
  "00000000-0000-0000-0000-000000000040",
  "00000000-0000-0000-0000-000000000041",
  "00000000-0000-0000-0000-000000000042",
  "00000000-0000-0000-0000-000000000043",
  "00000000-0000-0000-0000-000000000044",
  "00000000-0000-0000-0000-000000000045",
  "00000000-0000-0000-0000-000000000046",
  "00000000-0000-0000-0000-000000000047",
  "00000000-0000-0000-0000-000000000048",
  "00000000-0000-0000-0000-000000000049",
  "00000000-0000-0000-0000-000000000050"
];

// ⚙️ 최초 실행: save 요청 보내기 (1회)
export function setup() {
  for (const userId of userIds) {
    const url = `${BASE_URL}/${userId}/save`;
    const res = http.get(url, null);  // params 없음
    console.log(`Saved activity for ${userId} => status: ${res.status}`);
  }
}

export default function () {

  group('조회 테스트', () => {
    for (const userId of userIds) {
      const url = `${BASE_URL}/${userId}/query`;
      const res = http.get(url);

      const success = check(res, {
        'status is 200': (r) => r.status === 200,
      });

      if (!success) {
        console.error(
            `❌ userId=${userId}, status=${res.status}, body=${res.body}`);
      }

      sleep(0.005); // 요청 간 간격
    }
  });
}
